var NewsletterController=function(){return{configs:{email_input:'',register_button:'',form_wrapper:'',target_endpoint:'/utils?action=newsletter',thanks_message_wrapper:'',multiple_target_endpoints:[],email_registered_callback:false},init:function(){this.bind_listeners();},bind_listeners:function(){this.configs.register_button.click(function(e){e.preventDefault();var clicked_button=$(this),form_container=clicked_button.closest("form");if(NewsletterController.validation(form_container)){if(NewsletterController.configs.multiple_target_endpoints.length!==0){NewsletterController.register_email_multiple_hotels(form_container);}else{NewsletterController.register_email(form_container);}}});this.configs.form_wrapper.keypress(e=>{if(e.which==13){e.preventDefault();if(NewsletterController.validation(this.configs.form_wrapper)){if(NewsletterController.configs.multiple_target_endpoints.length!==0){NewsletterController.register_email_multiple_hotels(this.configs.form_wrapper);}else{NewsletterController.register_email(this.configs.form_wrapper);}}}});},validation:function(form_container){let is_success=true;if(form_container.find('input[name=email]')){let email_input=form_container.find('input[name=email]')
const emailReg=/^$|^([\w\.\-]+)@([\w\-]+)((\.(\w){2,3})+)$/;if(!emailReg.test(email_input.val())){is_success=false;email_input.addClass('error');return;}
email_input.removeClass('error');}
form_container.find('.required').each(function(){var html_type=$(this).attr('type');if(html_type==='checkbox'){if(!$(this).is(':checked')){is_success=false;$(this).addClass('error');$(this).parent().addClass('error');return;}}
if(html_type==='text'){if(!$(this).val()){is_success=false;$(this).addClass('error');return;}}
$(this).removeClass('error');$(".newsletter_checkbox").removeClass('error');});if(!this.captcha_is_valid(form_container)){is_success=false;return}
return is_success;},captcha_is_valid:function(form_container){let target_response_recaptcha=form_container.find("#g-recaptcha-response"),recaptcha_wrapper=form_container.find(".g-recaptcha");if(!target_response_recaptcha.length){return true;}
if(!target_response_recaptcha.val()){recaptcha_wrapper.addClass('error');return false;}else{recaptcha_wrapper.removeClass('error');return true;}},_process_data:function(form_container){var data_form={};form_container.find('input,textarea').each(function(){var input_name=$(this).attr('name'),input_value=$(this).val();if($(this).attr('type')==='checkbox'){data_form[input_name]=$(this).is(':checked');}else{data_form[input_name]=input_value;}});return data_form;},clean_form:function(form_container){form_container.find('input:not([type=hidden]),textarea').each(function(){if($(this).attr('type')==='checkbox'){$(this).prop("checked",false);}else{$(this).val('');}});},thanks_message:function(form_container){if(this.configs.form_wrapper.length>1){if(form_container.find("div.thanks_message_wrapper").length){alert(form_container.find("div.thanks_message_wrapper").html())}}else if(this.configs.thanks_message_wrapper.length){alert(this.configs.thanks_message_wrapper.html());}},register_email:function(form_container){var form_data=this._process_data(form_container);form_data['action']='newsletter';$.post(this.configs.target_endpoint,form_data,function(e){console.log(e);NewsletterController.clean_form(form_container);NewsletterController.thanks_message(form_container);if(NewsletterController.configs.email_registered_callback&&typeof(NewsletterController.configs.email_registered_callback)==="function"){NewsletterController.configs.email_registered_callback();}});if(typeof HubspotController!=="undefined"){HubspotController.sendData(form_data,'newsletter');}},register_email_multiple_hotels:function(form_container){var form_data=this._process_data(form_container);form_data['action']='newsletter';this.configs.multiple_target_endpoints.forEach(function(endpoint){$.post(endpoint,form_data,function(e){console.log(e);});});NewsletterController.clean_form(form_container);NewsletterController.thanks_message(form_container);if(NewsletterController.configs.email_registered_callback&&typeof(NewsletterController.configs.email_registered_callback)==="function"){NewsletterController.configs.email_registered_callback();}}};}();