if(void 0===structuredClone)function structuredClone(e){return JSON.parse(JSON.stringify(e))}const POPUP_SEEKER={config:{base_url:"https://popup-seeker-296770026789.europe-west1.run.app",banners_list_endpoint:"/api/entities/Banner",is_mobile:!1,hotel_code:"",language:"",language_code:"",country_code:"",section_type:"",section_key:"",booking_step:"",user_type:["normal"],availability:!0,promocode:"",cookie_name:"popup_seeker",request_cache_name:"popup_seeker_v2",debug:!1,local:!1,public_captcha_key:null,ga:{category:"Popup Seeker"},is_iframe:!1,supported_events:["visibilitychange","payment_failed.payment.controller","payment_failed_reiterative.payment.controller"]},data:{user_info:null,countries_list:null,phone_prefixes:null,extra_context:{}},state:{preload_listeners_bound:!1,initialized:!1,shown_banners:[],event_queue:[]},init:async function(e){this.state.initialized?console.warn("[Popup Seeker] Already initialized"):(console.log("[Popup Seeker] Initializing"),this.state.initialized=!0,this._process_init_params(e),IdleController.init(),await this.prepare_banners())},reinit:async function(e){this._reset_controller_state(),this._process_init_params(e),IdleController.reset_timer(),await this.prepare_banners()},_reset_controller_state:function(){this.state.event_queue=[],this.data.user_info=null,this.data.extra_context={},this.state.shown_banners=[]},_process_init_params:function(e){if(e){let{extra_context:t,...n}=e;t&&(this.data.extra_context={...t}),this.config={...this.config,...n}}e&&void 0!==e.is_mobile||(this.config.is_mobile=this._is_mobile()),this.config.hotel_code?(this.config.language_code||(this.config.language_code=this._get_language_code()),this.config.language||(this.config.language=this._get_language_from_language_code(this.config.language_code)),this.config.country_code||(this.config.country_code=this._get_country_code()),this.data.user_info=this.get_user_info(),this.config.is_iframe=window.location!==window.parent.location,this.config.local&&(this.config.base_url="http://localhost:9080")):console.warn("[Popup Seeker] Hotel code is required to initialize Popup Seeker")},push_event_to_queue:function(e,t){let n=e.type;e.namespace&&(n=`${n}.${e.namespace.split(".").reverse().join(".")}`),POPUP_SEEKER.state.event_queue.push({event_name:n,context:t})},bind_preload_listeners:function(){this.state.preload_listeners_bound||(this.config.supported_events.forEach((e=>{$(document).on(e,this.push_event_to_queue)})),this.state.preload_listeners_bound=!0)},unbind_preload_listeners:function(){this.state.preload_listeners_bound&&(this.config.supported_events.forEach((e=>{$(document).off(e,this.push_event_to_queue)})),POPUP_SEEKER.state.event_queue=[],this.state.preload_listeners_bound=!1)},bind_banner_event_listener:function(e,t){let n=this.state.event_queue.filter((t=>t.event_name===e));n.length&&n.forEach((e=>{t(e.context)})),this.state.event_queue=this.state.event_queue.filter((t=>t.event_name!==e)),$(document).on(e,((e,n)=>{t(n)}))},get_user_info:function(){let e=this.search_cookie(this.config.cookie_name);return e?JSON.parse(this._fromB64(e)):{}},save_user_info:function(){if(this.data.user_info){let e=this._toB64(JSON.stringify(this.data.user_info));this.create_cookie(this.config.cookie_name,e)}},prepare_banners:async function(){let e={hotel_code:this.config.hotel_code,enabled:!0};await $.get(this.config.base_url+this.config.banners_list_endpoint,e,(e=>{let t=this.get_valid_banners(e);console.debug(`[Popup Seeker] Banners found (total/valid): ${e.length}/${t.length}`),t.length>0&&this.build_banners(t),this.unbind_preload_listeners()})),IdleController.start_timer()},get_valid_banners:function(e){let t=[];for(let n of e){let e=!1;if(n.show_filter){let t=n.name,a=n.show_filter.desktop||!1,i=n.show_filter.mobile||!1,o=n.show_filter.section_types||[],r=n.show_filter.sections||[],s=n.show_filter.booking_steps||[],l=n.show_filter.user_types||[],c=n.show_filter.availability||"",_=n.show_filter.language_codes||[],d=n.show_filter.referer||"",p=n.show_filter.url||"",u=n.show_filter.promocode||"",h=new Date,f=new Date(n.show_filter.starts_on),b=new Date(n.show_filter.expires_on);if((this.config.is_mobile||!a)&&(!this.config.is_mobile||!i)){console.debug("[Popup Seeker] Excluded by device: "+t);continue}if(!isNaN(f)&&h<f||!isNaN(b)&&h>b){console.debug("[Popup Seeker] Excluded by date: "+t);continue}if(_.length&&!_.includes("all")&&!_.includes(this.config.language_code)){console.debug("[Popup Seeker] Excluded by language: "+t);continue}if(d&&!new RegExp(d,"i").test(document.referrer)){console.debug("[Popup Seeker] Excluded by referer: "+t);continue}if(p&&!new RegExp(p,"i").test(document.URL)){console.debug(`[Popup Seeker] Excluded by URL: ${t}`);continue}if(u&&!new RegExp(u).test(this.config.promocode)){console.debug("[Popup Seeker] Excluded by promocode: "+t);continue}if(l.length&&!this.config.user_type.some((e=>l.includes(e)))){console.debug(`[Popup Seeker] Excluded by user type (${this.config.user_type}): ${t}`);continue}if(this.config.section_type&&o.length&&(o.includes("all")||o.includes(this.config.section_type))&&(console.debug("[Popup Seeker] Included by section_type: "+t),e=!0),this.config.section_key&&r.length&&(r.includes("all")||r.includes(this.config.section_key))&&(console.debug("[Popup Seeker] Included by section_key: "+t),e=!0),this.config.booking_step&&s.length&&(s.includes("all")||s.includes(this.config.booking_step)))if(c){if(!("available"===c&&this.config.availability||"unavailable"===c&&!this.config.availability)){console.debug("[Popup Seeker] Included by booking_step but excluded by availability: "+t);continue}console.debug("[Popup Seeker] Included by booking_step and availability: "+t),e=!0}else console.debug("[Popup Seeker] Included by booking_step: "+t),e=!0}e&&t.push(n)}return t},build_banners:function(e){for(const t of e){let e=t.show_filter.timing;Array.isArray(e)||(e=[e]);for(let n of e)switch(n){case"immediately":this.insert_banner(t);break;case"delay":let e=Math.max(t.show_filter.delay_seconds||0,0);setTimeout((()=>{this.insert_banner(t)}),1e3*e);break;case"inactivity":let n=Math.max(t.show_filter.inactivity_seconds||0,0);IdleController.add_handler((()=>{this.insert_banner(t)}),n);break;case"page_abandoning":this.config.is_mobile||$(document).on("mouseleave",(e=>{e.pageY-$(window).scrollTop()<=1&&this.insert_banner(t)})),this.bind_banner_event_listener("visibilitychange",(()=>{this.insert_banner(t)}));break;case"event":let a=t.show_filter.event_name;a&&this.bind_banner_event_listener(a,(e=>{this.insert_banner(t,e)}));break;default:console.warn(`[Popup Seeker] Unknown timing option: ${t.show_filter.timing}. Showing popup right away`),this.insert_banner(t)}}},insert_banner:async function(e,t){if(!this._need_to_show_banner(e))return;this.state.shown_banners.push(e.id);let n=$(`body #banner_${e.id}_wrapper`),a=!0,i=e.properties.max_banners||1;if(n.length)switch(e.properties.banners_per_page){case"single_first":default:a=!1;break;case"single_last":n.remove();break;case"multiple_first_x":n.length>=i&&(a=!1,n=$());break;case"multiple_last_x":n.length>=i&&n.first().remove();case"multiple_all":}if(a){let a,i=$("body"),o="append";switch(n=await this.build_banner(e,t),e.properties.banner_type){case"static":let t=e.properties.target_element;t&&(a=$(t)),e.properties.insertion_type&&(o=e.properties.insertion_type);break;case"floating":let n=e.properties.banner_position,r=$(`.banner_floating_wrapper.${n.replace("_",".")}`);if(r.length)a=r;else{let e=$("<div></div>",{class:`banner_floating_wrapper ${n.replace("_"," ")}`});switch(e.css({position:"fixed"}),n){case"top_left":e.css({top:"0",left:"0"});break;case"top_right":e.css({top:"0",right:"0"});break;case"bottom_left":e.css({bottom:"0",left:"0"});break;case"bottom_right":e.css({bottom:"0",right:"0"});break;case"notification":e.css({top:"15vh",right:"0"});break;default:console.warn(`[Popup Seeker] Unknown floating banner position: ${n}`)}i.append(e),a=e}let s=this.config.is_mobile?{...e.css["#banner_@@id@@_wrapper"],...e.css_mobile["#banner_@@id@@_wrapper"]}:e.css["#banner_@@id@@_wrapper"];s["z-index"]&&a.css({"z-index":s["z-index"]});break;default:a=i}switch(o){case"prepend":a.prepend(n);break;case"before":a.before(n);break;case"after":a.after(n);break;default:a.append(n)}this.init_form_recaptcha(n),this.init_countdowns(n)}if(this.show_banner(n),n.attr("data-shown-timestamp",(new Date).toISOString()),e.show_filter.active_time){const t=Math.max(e.show_filter.active_time||0,0);if(!t||t<1)return;setTimeout((()=>{this.close_banner(n)}),1e3*t)}},_need_to_show_banner:function(e){let t=!0;if(e.show_filter.show_once_per||(e.show_filter.show_once_per=e.show_filter.show_once?"user":"page"),e.show_filter.show_once_per){let t=this.state.shown_banners.includes(e.id);switch(e.show_filter.show_once_per){case"event":if(t&&(e.show_filter.timing.includes("inactivity")||e.show_filter.timing.includes("page_abandoning")))return console.debug(`[Popup Seeker] Banner ${e.name} already shown at current page`),!1;break;case"page":if(t)return console.debug(`[Popup Seeker] Banner ${e.name} already shown at current page`),!1;break;case"user":if(this.data.user_info.shown_banners?.find((t=>t===e.id)))return console.debug(`[Popup Seeker] Banner ${e.name} already shown to the user`),!1;this.data.user_info.shown_banners=this.data.user_info.shown_banners||[],this.data.user_info.shown_banners.push(e.id),this.save_user_info()}}if(e.show_filter.ab_testing){this.data.user_info.ab_testing_banners=this.data.user_info.ab_testing_banners||{};let n=e.show_filter.users_percent,a=this.data.user_info.ab_testing_banners[e.id],i=Math.random()<n/100;const o=()=>{this.data.user_info.ab_testing_banners[e.id]={users_percent:n,show:i}};a&&n===a.users_percent?i=a.show:o(),i||(t=!1),this.save_user_info()}return t},build_banner:async function(e,t){console.debug("[Popup Seeker] Banner data:"),console.debug(e);let n=this._replace_content_variables(e.content?.default?.find((e=>"banner_wrapper"===e.block_type))?.properties?.extra_class||"",t),a=this._replace_content_variables(e.content?.default?.find((e=>"banner"===e.block_type))?.properties?.extra_class||"",t),i=$("<div></div>",{id:`banner_${e.id}_wrapper`,class:`banner_wrapper ${n}`,"data-banner-name":e.name}),o=$("<div></div>",{id:`banner_${e.id}`,class:`banner ${a}`}),r=$("<style></style>",{id:`banner_${e.id}_styles`,class:"banner_styles"}),s=$('<i class="fas fa-times close"></i>');return this.config.is_mobile&&(i.addClass("mobile"),o.addClass("mobile")),await this._add_banner_dependencies(i,e),e.content?.default&&e.content.default.forEach((t=>{this._render_block_css(r,t,e)})),e.content?.extra&&e.content.extra.forEach((n=>{let a=this._create_content_element(e.id,n,this.config.language,t);a&&(this._render_block_css(r,n,e),o.append(a))})),e.extra_css&&r.append(e.extra_css.replaceAll("@@id@@",e.id).replaceAll("@@current@@","#banner_"+e.id)),i.append(r),i.append(o),o.append(s),e.content?.extra&&e.content.extra.forEach((t=>{let n=t.properties.parent_container;if(n){let a=i.find(t.selector.replaceAll("@@id@@",e.id).replaceAll("@@current@@","#banner_"+e.id)),o=i.find(n.replaceAll("@@id@@",e.id).replaceAll("@@current@@","#banner_"+e.id));a.length&&o.length&&o.append(a)}})),this.add_listeners(i,e),i.hide(),i},_add_banner_dependencies:async function(e,t){let n=t.content.extra.filter((e=>"form"===e.block_type));if(t.properties.fonts_import_link){let n=$("<link>").attr("rel","stylesheet").attr("href",t.properties.fonts_import_link).addClass("banner_fonts");e.append(n)}if("undefined"==typeof grecaptcha){let e=this.config.public_captcha_key,t=!1;for(let a of n)a.properties.recaptcha&&(t=!0),!e&&a.properties.recaptcha_public_key&&(e=a.properties.recaptcha_public_key,t=!0);t&&e&&await $.getScript("https://www.google.com/recaptcha/api.js?render=explicit")}for(let e of n){let t=e.fields;for(let e of t)"select"===e.properties.type&&("country"!==e.properties.select_type||this.data.countries_list||await this._get_countries_list(),"phone_prefix"!==e.properties.select_type||this.data.phone_prefixes||await this._get_phone_prefixes())}},_get_countries_list:async function(){POPUP_SEEKER.data.countries_list=await this._make_cached_request(`${this.config.base_url}/utils/get_countries`).then((e=>e.json()))},_get_phone_prefixes:async function(){POPUP_SEEKER.data.phone_prefixes=await this._make_cached_request(`${this.config.base_url}/utils/get_phone_prefixes`).then((e=>e.json()))},add_listeners:function(e,t){if(e.find(".close").on("click",(function(){POPUP_SEEKER.close_banner($(this).closest(".banner_wrapper"))})),t.content?.default){let n=t.content.default.find((e=>"banner_wrapper"===e.block_type));n?.properties?.close_on_click&&e.on("click",(function(e){e.target===this&&POPUP_SEEKER.close_banner($(this))}))}},_get_language_code:function(){return $("html").attr("lang")},_is_mobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},_get_country_code:function(){let e=navigator.language||navigator.userLanguage;return(e.includes("-")?e.split("-")[1]:e).toUpperCase()},_add_css_rule:function(e,t,n,a=null){let i=`${t} {\n`;for(let[e,t]of Object.entries(n)){let n=this._adapt_css_property(e,t);"background-image"===e&&"background-overlay"in a&&(n.value=`linear-gradient(0deg, ${a["background-overlay"]}, ${a["background-overlay"]}), `+n.value),i+=`\t${n.name}: ${n.value};\n`,"backdrop-filter"===e&&(i+=`\t-webkit-backdrop-filter: ${n.value};\n`)}i+="}\n\n",e.append(i)},_adapt_css_property:function(e,t){let n={name:e.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase())),value:t};return"background-image"!==e||t.includes("url(")||(n.value=`url('${t}')`),n},_render_block_css:function(e,t,n){let a=t.selector.replaceAll("@@id@@",n.id).replaceAll("@@current@@","#banner_"+n.id),i=n.css[t.selector],o=this.config.is_mobile?{...i,...n.css_mobile[t.selector]}:structuredClone(i);if(this._add_css_rule(e,a,o,t.properties),t.inner_elements){let a=structuredClone(t.inner_elements);for(let i of a){let a=i.selector.replaceAll("@@id@@",n.id).replaceAll("@@current@@","#banner_"+n.id),o=this.config.is_mobile?{...n.css[i.selector],...n.css_mobile[i.selector]}:structuredClone(n.css[i.selector]);this._add_css_rule(e,a,o,t.properties)}}if("tooltip"===t.block_type&&t.properties.parent_container){let a=`${t.properties.parent_container.replaceAll("@@id@@",n.id).replaceAll("@@current@@","#banner_"+n.id)}:hover .${t.block_type}_${t.block_num}`,i={opacity:"1",visibility:"visible","pointer-events":"auto"};this._add_css_rule(e,a,i,t.properties)}},_get_language_from_language_code:function(e){return{es:"SPANISH",en:"ENGLISH",de:"GERMAN",fr:"FRENCH",pt:"PORTUGUESE",pl:"POLISH",nl:"DUTCH",ru:"RUSSIAN",ca:"CATALAN",fi:"FINNISH",it:"ITALIAN",sv:"SWEDISH",ja:"JAPANESE",ko:"KOREAN"}[e.toLowerCase()]},_replace_predefined_variables:function(e){if(e){e=(e=(e=e.replaceAll("@@hotel_code@@",this.config.hotel_code||"")).replaceAll("@@language_code@@",this.config.language_code||"")).replaceAll("@@device@@",this.config.is_mobile?"mobile":"desktop");for(let[t,n]of Object.entries(this.data.extra_context))e=e.replaceAll(`@@${t}@@`,n)}return e},_replace_content_variables:function(e,t){let n=e;if(t&&n)for(let[e,a]of Object.entries(t))n=n.replaceAll(`@@${e}@@`,a);return n=this._replace_predefined_variables(n),n},_create_content_element:function(e,t,n,a){let i,o={...t.properties,...t.properties_per_language[n]},r={class:`${t.block_type}_${t.block_num}`};switch(t.block_type){case"container":i=$("<div></div>",r);break;case"text":case"tooltip":i=$("<div></div>",{...r,html:this._replace_content_variables(o.content,a)});break;case"image":i=$("<img/>",{...r,src:this._replace_content_variables(o.src,a)}).attr("draggable","false");break;case"button":i=this._create_button_element(o,r,a);break;case"form":i=this._create_form_element(e,t,o,r,n,a);break;case"countdown":i=this._create_countdown_element(o,r);break;default:console.error("[Popup Seeker] Cannot handle element of type: "+t.block_type)}return o.hidden&&i.css({display:"none"}),i},_create_button_element:function(e,t,n){let a={...t,html:this._replace_content_variables(e.text,n)};switch(e.button_type){case"link":Object.assign(a,{href:this._replace_content_variables(e.href,n),target:e.target||void 0});break;case"booking_button":let t=this._get_smart_datas(e);Object.assign(a,{class:`${a.class} button-promotion`,href:"#data",...t});break;case"event_trigger":break;case"scroll":Object.assign(a,{href:this._replace_content_variables(e.scroll_target,n)});break;default:console.warn("[Popup Seeker] Cannot handle button of type: "+e.button_type)}let i=$("<a></a>",a);return this._bind_button_event_listeners(i,e),i},_create_form_element:function(e,t,n,a,i,o){let r=t.fields,s={...a,method:"POST"};"custom"===n.form_type?s.action=n.endpoint:s.action=(n.domain||"")+"/utils";let l=$("<form></form>",s);if("custom"!==n.form_type){let e=$("<input>",{type:"hidden",name:"action",value:n.form_type});l.append(e)}let c=$("<button></button>",{type:"submit",html:n.button_text});if(this._create_form_fields(l,e,t,r,o,i),n.recaptcha)if(this.config.public_captcha_key){let n=`ps_recaptcha_container_${e}_form_${t.block_num}`,a=$("<div></div>",{class:"recaptcha_container",id:n,"data-sitekey":this.config.public_captcha_key,"data-size":this.config.is_mobile?"compact":"normal"});l.append(a)}else console.warn("[Popup Seeker] Recaptcha is enabled for a form but public key is missing");return l.append(c),this._bind_form_event_listeners(e,l,n),l},_create_form_fields:function(e,t,n,a,i,o){for(let r of a){let a={...r.properties,...r.properties_per_language[o]},s=(r.options,`banner_${t}_form_${n.block_num}_field_${r.id}`),l={id:s,name:a.name||void 0,placeholder:this._replace_content_variables(a.placeholder||void 0,i),value:this._replace_content_variables(a.value||void 0,i),required:a.required},c=$();switch(a.type){case"input":l.type=a.input_type||"text",c=$("<input>",l);break;case"textarea":c=$("<textarea></textarea>",l);break;case"checkbox":l.type="checkbox",c=$("<input>",l);break;case"radio":l.type="radio",c=$("<input>",l);break;case"select":c=$("<select></select>",l),this._create_select_options(c,r,a,o,i);break;case"hidden":l.type="hidden",c=$("<input>",l);break;default:console.warn("[Popup Seeker] Cannot handle field of type: "+a.type)}if(a.trigger_event&&a.event_name&&c.attr("data-trigger-event",a.event_name),"hidden"===a.type)e.append(c);else{let t=$("<div></div>",{class:`input_wrapper ${a.type}`});if(t.append(c),a.label){let e=$("<label></label>",{for:s,html:this._replace_content_variables(a.label,i)});["checkbox","radio"].includes(a.type)?t.append(e):t.prepend(e)}e.append(t)}}},_create_select_options:function(e,t,n,a,i){let o=[],r=this._get_country_code();switch(n.select_type){case"country":o=this.data.countries_list.map((e=>({value:e.code,text:this._replace_content_variables(e.name,i),selected:e.code===r})));break;case"phone_prefix":o=this.data.phone_prefixes.map((e=>({value:e.dial_code,text:this._replace_content_variables(`${e.name} (${e.dial_code})`,i),selected:e.code===r})));break;case"custom":o=(t.options||[]).map((e=>{let t={...e.properties,...e.properties_per_language[a]};return{value:this._replace_content_variables(t.value,i),text:this._replace_content_variables(t.label,i)}}));break;default:return void console.warn("[Preview] Cannot handle select type: "+n.select_type)}for(let t of o)e.append($("<option></option>",t))},_create_countdown_element:function(e,t){let n=$("<div></div>",{...t,class:t.class+" countdown","data-expiration-date":e.expiration_date});for(let t of["days","hours","minutes","seconds"])if(e["has_"+t]){let a=$("<div></div>",{class:`countdown_item ${t}`});a.append($("<div></div>",{class:"countdown_item_value",text:"0"})),a.append($("<div></div>",{class:"countdown_item_label",text:e[t+"_label"]})),n.append(a)}return n},init_form_recaptcha:function(e){e.find(".recaptcha_container").each((function(){let e=$(this),t=e.attr("id"),n="";grecaptcha.ready((function(){n=grecaptcha.render(t,{callback:()=>{$(this).removeClass("error")}}),e.attr("data-widget-id",n)}))}))},init_countdowns:function(e){e.find(".countdown").each((function(){let e=new Date($(this).attr("data-expiration-date")).getTime()||0;const t=()=>{let t=(new Date).getTime(),a=e-t,i={days:Math.max(Math.floor(a/864e5),0),hours:Math.max(Math.floor(a%864e5/36e5),0),minutes:Math.max(Math.floor(a%36e5/6e4),0),seconds:Math.max(Math.floor(a%6e4/1e3),0)};for(let e of["days","hours","minutes","seconds"])$(this).find(`.countdown_item.${e} .countdown_item_value`).text(String(i[e]).padStart(2,"0"));a<0&&clearInterval(n)};let n=setInterval((()=>{t()}),1e3);t()}))},_get_smart_datas:function(e){let t={};return e.start_date&&(t["data-smartdateini"]=new Date(e.start_date).toLocaleDateString("en-GB")),e.end_date&&(t["data-smartdatefin"]=new Date(e.end_date).toLocaleDateString("en-GB")),e.min_date&&(t["data-smartmindate"]=e.min_date),e.max_date&&(t["data-smartmaxdate"]=e.max_date),e.adults&&(t["data-smartadults"]=e.adults),e.kids&&(t["data-smartkids"]=e.kids),e.hotel&&(t["data-smarthotel"]=e.hotel),e.promocode&&(t["data-smartpromocode"]=e.promocode),e.package&&(t["data-smartpackage"]="true"),e.packages_order&&(t["data-smartpackageorder"]=e.packages_order),e.package_hidden_name&&(t["data-hidden_name"]=e.package_hidden_name),t},_bind_button_event_listeners:function(e,t){e.on("click",(function(e){let n=$(this).closest(".banner_wrapper"),a=n.attr("data-banner-name");switch(t.button_type){case"link":POPUP_SEEKER.trigger_ga_event("Popup link clicked",a);break;case"booking_button":POPUP_SEEKER.close_banner(n),POPUP_SEEKER.trigger_ga_event("Popup booking button clicked",a);break;case"event_trigger":t.close_on_click&&POPUP_SEEKER.close_banner(n),t.event_name&&($(document).trigger(t.event_name),POPUP_SEEKER.trigger_ga_event(`Popup event triggered - ${t.event_name}`,a));break;case"scroll":let i=$(this).attr("href"),o=t.scroll_offset||0,r=t.scroll_duration||0,s=$(i).offset().top-o;e.preventDefault(),$("html, body").animate({scrollTop:s},r),POPUP_SEEKER.trigger_ga_event("Popup scroll button clicked",a);break;default:console.warn("[Popup Seeker] Cannot handle button of type: "+t.button_type)}}))},_bind_form_event_listeners:function(e,t,n){t.on("submit",(function(a){if(a.preventDefault(),!$(this).hasClass("submitting")){let a=$(this).attr("method"),i=$(this).attr("action"),o=POPUP_SEEKER._form_array_to_object($(this).serializeArray()),r=t.find(".recaptcha_container");if(r.length){let e=grecaptcha.getResponse(r.attr("data-widget-id"));if(!e)return void r.addClass("error");o["g-recaptcha-response"]=e}$(this).addClass("submitting"),$.ajax({url:i,data:o,type:a,success:function(){let a=t.closest(".banner_wrapper").attr("data-banner-name");switch(n.on_submit){case"close":POPUP_SEEKER.close_banner(t.closest(".banner_wrapper"));break;case"alert":POPUP_SEEKER.close_banner(t.closest(".banner_wrapper")),alert(n.submit_alert_message||"");break;case"toggle_blocks":if(n?.toggle_blocks?.length)for(let t of n.toggle_blocks){let n=t.replaceAll("@@id@@",e).replaceAll("@@current@@","#banner_"+e);$(n).toggle()}}t.find("[data-trigger-event]").each((function(){let e=$(this).attr("data-trigger-event"),t=$(this).val(),n=["checkbox","radio"].includes($(this).attr("type"));(n&&$(this).prop("checked")||!n&&t)&&$(document).trigger(e)})),t.removeClass("submitting"),POPUP_SEEKER.trigger_ga_event("Popup form submitted",a)},error:function(){switch(n.on_error){case"close":POPUP_SEEKER.close_banner(t.closest(".banner_wrapper"));break;case"alert":alert(n.error_alert_message||"Error")}t.removeClass("submitting")}})}}))},_form_array_to_object:function(e,t=!1){let n={};return e.forEach((e=>{e.name&&(e.value||t)&&(n[e.name]="on"===e.value||e.value)})),n},create_cookie:function(e,t){let n=new Date,a=`${e}=${t}; path=/`;n.setMonth(n.getMonth()+12),a+=`; expires=${n.toUTCString()}`,this.config.is_iframe&&(a+="; SameSite=None; Secure"),document.cookie=a},search_cookie:function(e){return document.cookie.split(";").find((t=>t.trim().startsWith(e+"=")))?.split("=")[1]},delete_cookie:function(e){document.cookie=e+"=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT"},_toB64:function(e){return btoa(encodeURIComponent(e))},_fromB64:function(e){return decodeURIComponent(atob(e))},trigger_ga_event:function(e,t,n){let a={event_category:this.config.ga.category,event_action:e,event_label:t};"number"==typeof n&&(a.value=n),console.debug("[Popup Seeker] GA event triggered:"),console.debug(a),window.dataLayer=window.dataLayer||[];const i=()=>{if(window.dataLayer.push({event:"popup-seeker-event-gtm",...a}),"function"==typeof gtag&&gtag("event","popup-seeker-event",{...a}),"function"==typeof ga){let e={eventCategory:a.event_category,eventAction:a.event_action,eventLabel:a.event_label,transport:"beacon"};"number"==typeof n&&(e.value=n),ga("send","event",e)}};"object"!=typeof cookiesController||["all_accepted","disabled"].includes(window.cookies_selection)||cookiesController.search_cookie("cookies_preference")?i():("function"!=typeof user_allowed_to_track||user_allowed_to_track())&&cookiesController.push_tracking_code(i,["analytics"])},show_banner:function(e){let t=e.attr("data-banner-name");e.fadeIn("slow"),this.trigger_ga_event("Popup shown",t)},close_banner:function(e){let t=e.attr("data-banner-name");e.fadeOut("slow"),this.trigger_ga_event("Popup closed",t),this.trigger_ga_event("Popup opened duration",t,this._calculate_popup_opened_duration(e))},_calculate_popup_opened_duration:function(e){let t=e.attr("data-shown-timestamp");return t?Math.min(Math.round((new Date-new Date(t))/1e3),600):0},_make_cached_request:function(e){let t=(e,t=!1)=>fetch(e).then((n=>{let a=n.clone();if(!a.ok)throw new TypeError("Bad response status");return t&&t.put(e,a),n}));try{return caches.open(this.config.request_cache_name).then((n=>n.match(e).then((a=>a?(console.debug(`[Popup Seeker] Cache hit: ${e}`),a):(console.debug(`[Popup Seeker] Cache miss: ${e}`),t(e,n)))))).catch((n=>(console.warn("[Popup Seeker] CacheStorage not supported"),t(e))))}catch(n){return console.warn("[Popup Seeker] CacheStorage not supported"),t(e)}}},IdleController={config:{initialized:!1,idle_time:0,interval_period:1,interval_id:0,events:"mousemove keydown mousedown touchstart scroll",handlers:[]},init:function(){this.config.initialized||(this.bind_listeners(),this.config.initialized=!0)},reset_timer:function(){this.config.idle_time=0},start_timer:function(){this.config.interval_id=setInterval((()=>{this.config.idle_time+=this.config.interval_period,this.config.handlers=this.config.handlers.filter((e=>!(this.config.idle_time>=e.delay&&(e.callback(),1)))),this.config.handlers.length||this.stop_timer()}),1e3*this.config.interval_period)},stop_timer:function(){this.config.interval_id&&(clearInterval(this.config.interval_id),this.config.interval_id=0)},bind_listeners:function(){$(document).on(this.config.events,(()=>{this.config.idle_time=0}))},add_handler:function(e,t){let n={delay:t,callback:e};this.config.handlers.push(n)}};POPUP_SEEKER.bind_preload_listeners();